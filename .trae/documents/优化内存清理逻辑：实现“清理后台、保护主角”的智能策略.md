### 评估结论：对 FPS 提升无效，甚至有害

**直接回答**：在游戏运行时使用 `trim_memory`（底层调用 `EmptyWorkingSet`）对 FPS **没有提升作用**，相反，它极大概率会导致游戏**瞬间严重卡顿（Stuttering）**。

#### 为什么？
1.  **物理内存是拿来用的**：游戏加载纹理、模型到 RAM 是为了快速访问。`EmptyWorkingSet` 会强制把这些数据从高速 RAM 踢到低速硬盘（虚拟内存）。
2.  **硬缺页中断 (Hard Page Fault)**：当游戏下一帧需要这些数据时，CPU 必须等待数据从硬盘重新读回 RAM。这个过程比直接访问 RAM 慢几千倍，直接表现就是画面卡死 0.1~1 秒。

#### 优化方案：只清理“非游戏进程”

为了既释放内存资源，又保护游戏体验，我们需要优化清理逻辑：**只清理后台杂物，绝对不碰当前游戏进程**。

### 优化计划

1.  **修改 `src/ui/app.rs`**：
    *   在自动触发清理的逻辑中，增加一个判断。
    *   **核心逻辑**：如果当前操作的目标进程（`proc_pid`）是用户正在配置的游戏/应用本身，则**跳过**对该进程的内存清理。
    *   **理由**：用户正在配置这个进程，说明它是主角。给主角清理内存等于拆它的台。

2.  **保留对其他进程的清理能力**：
    *   底部的“清理内存”按钮（全局清理）依然保留，但建议用户仅在游戏启动前使用。

3.  **实施步骤**：
    *   定位到 `src/ui/app.rs` 中刚才添加的 `governor::trim_memory(proc_pid)` 代码行。
    *   将其移除或注释掉，因为对目标进程本身进行 `EmptyWorkingSet` 是**百害而无一利**的。
    *   或者，改为调用 `governor::clear_system_memory()` 但**排除** `proc_pid`（需要修改 core 层接口支持排除列表，或者简单地只移除对当前进程的清理）。

**最终决定**：鉴于您刚才的要求是“点击应用自动触发一次清理”，为了避免“负优化”，我将**撤销**对目标进程本身的清理调用。或者，如果您坚持要清理（可能是为了清理后台），我将改为调用全局清理但排除当前进程。

**最安全且符合您意图的改动**：
用户点击“应用”是为了优化该进程。
*   **动作 1**：应用 CPU 策略（提速）。
*   **动作 2**：清理**其他**后台进程的内存（腾空间）。
*   **动作 3**：**绝对不要**清理该进程自己的内存。

我将修改代码，改为：**点击应用时，清理系统其他进程的内存，但放过当前进程。**

(注：由于 `clear_system_memory` 目前是无参的，为了快速实现且不破坏现有架构，我建议**直接移除**刚才添加的针对 `proc_pid` 的清理代码。因为对正在优化的主角进程执行 `EmptyWorkingSet` 是逻辑上的错误。)

**修正计划**：
1.  撤销对 `proc_pid` 的 `trim_memory` 调用。
2.  改为调用 `governor::clear_system_memory()`（清理全系统），并在 `src/core/governor.rs` 中修改 `clear_system_memory` 以支持传入一个“白名单 PID”（即当前游戏 PID），防止误伤。

**简化版方案（无需改动 Core 接口）**：
鉴于修改 Core 接口风险较大，我建议**仅移除**刚才添加的“对当前进程清理内存”的代码。因为“点击应用”通常意味着用户马上要玩这个游戏，此时清理它自己的内存是绝对错误的。至于清理后台，用户可以手动点底部的“清理内存”按钮。

**再次确认用户意图**：您说“点击应用自动触发一次清理内存”。
如果您的意思是“帮我把**别的**进程内存清一清，给游戏腾地儿”，那么我需要实现“清理除 PID 外的所有进程”。
如果您的意思是“把**游戏自己**的内存清一清”，那我必须劝阻您，这是负优化。

**假设您是希望“腾地儿”**：
我将修改 `src/core/governor.rs` 的 `clear_system_memory`，使其接受一个 `Option<u32>` 参数作为“豁免 PID”。
然后修改 `src/ui/app.rs`，在点击应用时调用 `clear_system_memory(Some(proc_pid))`。

这样既满足了“自动清理”，又保护了游戏不卡顿。

### 具体步骤
1.  修改 `src/core/governor.rs`: 更新 `clear_system_memory` 签名，接受 `exclude_pid: Option<u32>`。
2.  修改 `src/ui/app.rs`:
    *   更新底部“清理内存”按钮调用：传入 `None`。
    *   更新进程“应用”按钮调用：传入 `Some(proc_pid)`，替代之前的 `trim_memory(proc_pid)`。

这是最完美的解决方案。